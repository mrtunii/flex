
@{
    ViewBag.Title = "TestSignal";
}

<h2>Requests</h2>

<div class="container" id="main_content">
    <!-- Page-Title -->
    <div class="row">
        <div class="col-sm-12">

   
            <table class="table table-striped" id="requestTable">
                <thead>
                    <tr>
                        <td>Type</td>
                        <th>Controller</th>
                        <th>Action</th>
                        <th>Request Start Date</th>
                        <th>Request End Date</th>
                        <th>Request Period</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="data in requestData">
                        <td v-html="data.icon"></td>
                        <td>{{ data.controllerName }}</td>
                        <td>{{ data.methodName }}</td>
                        <td>{{ data.requestStartDate }}</td>
                        <td>{{ data.requestEndDate }}</td>
                        <td>{{ data.requestPeriod }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


</div> <!-- container -->


@section scripts {
<!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.2/vue.min.js"></script>
<!--SignalR script to update the chat page and send messages.-->
<script>
    var chat = $.connection.logHub;
    var app = new Vue({
        el: '#main_content',
        data: {
            requestData:[]
        },
        methods: {
            detectIcon: function(requestPeriod) {
                if (requestPeriod <= 1) return '<i class="fa fa-check" style="color:green"></i>';
                if (requestPeriod > 1 && requestPeriod < 5) return '<i class="fa fa-check" style="color:#FFCC00"></i>';
                if (requestPeriod > 5) return icon = '<i class="fa fa-exclamation" style="color:red"></i>';
            },
            onRequestReceive: function (controllerName, methodName, requestStartDate, requestEndDate, requestPeriod) {
                var icon = this.detectIcon(requestPeriod);
               this.requestData.push({
                   controllerName: controllerName,
                   methodName: methodName,
                   requestStartDate: requestStartDate,
                   requestEndDate: requestEndDate,
                   requestPeriod: requestPeriod,
                   icon: icon
                });
            },  
            color: function (requestPeriod) {
                if (requestPeriod < 10) {
                    return 'red';
                }
            }
        },
       
        created: function () {
            $.connection.hub.start();
        }
    });

    chat.client.AddRequestLogToPage = app.onRequestReceive;
   
       
</script>
}

